---
- name: 'install build tools'
  package:
    name: "{{ item }}"
    state: installed
  with_items:
    - gcc
    - git

- name: 'install useful debugging tools'
  package:
    name: "{{ item }}"
    state: installed
  with_items:
    - tree
    - unzip
    - vim

- name: 'add jenkins user'
  user:
    name: "{{ build_user }}"
    shell: /bin/bash

- name: 'add basic .bashrc for jenkins user that sets up cargo env'
  file:
    path: "{{ build_user_home_path }}/.bashrc"
    owner: "{{ build_user }}"
    group: "{{ build_user }}"
    mode: 0644

- name: 'create ssh directory'
  file:
    path: "{{ build_user_home_path }}/.ssh"
    state: directory
    mode: 0700
    owner: "{{ build_user }}"
    group: "{{ build_user }}"

- name: 'add authorized key'
  authorized_key:
    user: "{{ build_user }}"
    state: present
    key: "{{ lookup('file', '../files/id_rsa.pub')}}"
    manage_dir: false
